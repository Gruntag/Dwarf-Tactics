import{d as pa,r as p,v as va,l as w,o as ha,m as ma,a as i,b as s,u as _,e as P,h as N,t as l,p as O,F as k,f as C,q as oe,i as ga,j as c,n as fe,s as ne,_ as fa}from"./index-BvOaJSXW.js";import{A as ba}from"./arrow-left-CxawHIp-.js";import{C as Me}from"./castle-B-WnVHdj.js";import{S as wa}from"./shield-CDn_KcM_.js";import{C as ya}from"./coins-BwfyU6rz.js";import{T as _a}from"./trophy-C9pwcYaj.js";import{H as ka}from"./hammer-U_XHeOSk.js";const Ta={class:"defense-page"},Ea={class:"top-bar"},Sa={class:"phase-pill"},xa={class:"phase-value"},Ca={class:"phase-value"},Da={class:"hero"},Ma={class:"hero-actions"},Aa={key:1,class:"status-pill"},Ra={key:2,class:"status-pill"},Pa={class:"stats-panel"},Ba={class:"stat-card"},Ia={class:"stat-label"},Ha={class:"stat-value"},$a={class:"progress-bar"},La={class:"stat-card"},Wa={class:"stat-label"},Na={class:"stat-value"},Oa={class:"stat-sub"},Ua={class:"stat-card"},Ga={class:"stat-label"},Fa={class:"stat-value"},za={class:"stat-sub"},Va={class:"stat-card"},Ka={class:"stat-label"},qa={class:"stat-value"},Ya={class:"stat-sub"},ja={class:"playfield"},Xa={class:"board-panel"},Ja={class:"panel-header"},Qa={class:"panel-subtext"},Za={class:"board-grid-wrapper"},es=["onClick"],as={key:0,class:"cell-label"},ss={key:1,class:"cell-label"},ts={key:2,class:"tower-chip"},os={class:"enemy-field"},ns={class:"enemy-health-bar"},ls={class:"explosion-field"},rs={class:"trace-field",viewBox:"0 0 1000 1000",preserveAspectRatio:"none"},is=["x1","y1","x2","y2"],cs={class:"command-panel"},us={class:"panel"},ds={class:"blueprint-grid"},ps=["onClick"],vs={class:"blueprint-header"},hs={class:"cost"},ms={class:"panel"},gs={class:"panel-header"},fs={key:0,class:"wave-info"},bs={class:"wave-value"},ws={class:"wave-label"},ys={class:"wave-value"},_s={class:"wave-label"},ks={key:0,class:"panel tower-menu"},Ts={class:"panel-header"},Es={class:"tower-upgrades"},Ss=["onClick"],xs={class:"cost"},Cs={key:1,class:"panel hint-panel"},Ds={key:0,class:"overlay"},Ms={class:"overlay-card"},As={class:"overlay-message"},le=200,Ae=260,be=5,B=800,U=120,T=100,Rs=1800,Ps=pa({__name:"DwarvenDefense",setup(Bs){const Y=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`id-${Math.random().toString(16).slice(2)}`,G=["S.########","#...#...##","###.#.#.##","#...#.#.##","#.###.#.##","#.....#.##","#######.##","#.......##","#.########","#........E"],re=G.length,j=G[0].length,Re=new Set([".","S","E"]),Pe=[[1,0],[-1,0],[0,1],[0,-1]],Be=U/B,Ie=["normal","fast","tough","swarm","boss"],we={normal:{key:"normal",name:"Grottling Pack",description:"Balanced raiders pressing the outer hall.",color:"#22c55e",shape:"circle",baseHealth:60,speed:.18,damage:8,bounty:4,count:12,spawnGap:2},fast:{key:"fast",name:"Blitz Stalkers",description:"Sprint twice as fast but remain fragile.",color:"#facc15",shape:"triangle",baseHealth:60,speed:.36,damage:6,bounty:5,count:12,spawnGap:2},tough:{key:"tough",name:"Azure Bulwarks",description:"Twice the health of a raider with heavy shields.",color:"#38bdf8",shape:"square",baseHealth:120,speed:.14,damage:12,bounty:8,count:8,spawnGap:3},swarm:{key:"swarm",name:"Deepwater Swarm",description:"Tenfold numbers, only a fifth the health.",color:"#1d4ed8",shape:"pentagon",baseHealth:12,speed:.22,damage:2,bounty:1,count:120,spawnGap:.2},boss:{key:"boss",name:"Amethyst Warlord",description:"Siege master with ten times a Bulwark's vitality.",color:"#a855f7",shape:"hexagon",baseHealth:1200,speed:.1,damage:40,bounty:120,count:1,spawnGap:1}},y={ballista:{key:"ballista",name:"Ballista Tower",short:"Bal",description:"Single-target bolts with reliable tempo.",cost:110,baseDamage:34,fireDelay:3,baseRange:3.2,behavior:"single",tags:["single target","medium speed","medium range"],baseUpgradeCosts:{range:70,speed:80,damage:90}},bomb:{key:"bomb",name:"Bomb Tower",short:"Bomb",description:"Arc barrels that explode in a small radius.",cost:140,baseDamage:42,fireDelay:4,baseRange:2.4,behavior:"aoe",aoeRadius:1.3,tags:["area damage","slow rate","medium range"],baseUpgradeCosts:{range:65,speed:90,damage:95}},sniper:{key:"sniper",name:"Sniper Tower",short:"Snp",description:"Extreme range shots that delete priority targets.",cost:155,baseDamage:110,fireDelay:6,baseRange:4.8,behavior:"single",tags:["very long range","very high damage","slow rate"],baseUpgradeCosts:{range:90,speed:110,damage:120}},wizard:{key:"wizard",name:"Wizard Tower",short:"Wiz",description:"Chain lightning that hits multiple raiders.",cost:150,baseDamage:58,fireDelay:3,baseRange:3.4,behavior:"chain",chainTargets:3,tags:["multi target","high damage","medium range"],baseUpgradeCosts:{range:80,speed:85,damage:105}},auto:{key:"auto",name:"Auto Tower",short:"Auto",description:"Rapid-fire cogs with modest damage.",cost:95,baseDamage:18,fireDelay:.5,baseRange:1.5,behavior:"single",tags:["single target","fast speed","mid-high range"],baseUpgradeCosts:{range:60,speed:70,damage:75}}},ie=[y.ballista,y.bomb,y.sniper,y.wizard,y.auto],ye=T/2,X=re*T,J=j*T,He={ballista:"ballista",bomb:"bomb",sniper:"sniper",wizard:"wizard",auto:"auto"},$e=ga(),ce=p([]),I=p(ie[0]),g=p("prep"),E=p(1),H=p(0),S=p(le),ue=p(le),x=p(Ae),v=va({towersPlaced:0,enemiesSlain:0,leaks:0,goldEarned:0,phasesCleared:0}),f=p([]),D=p(0),M=p(B),Q=p(null),A=p(!1),F=p(null),b=p(null),$=p([]),Z=new Map,L=p([]),ee=new Map,Le=w(()=>Math.max(0,Math.round(S.value/ue.value*100))),_e=w(()=>E.value),We=w(()=>_e.value*100),ke=w(()=>Ie[H.value]??null),u=w(()=>ke.value?we[ke.value]:null),Ne=w(()=>u.value?`Wave ${Math.min(H.value+1,be)} / ${be}`:"All Waves Cleared"),Oe=w(()=>u.value?Math.max(0,u.value.count-D.value):0),Ue=w(()=>g.value==="prep"&&!!u.value&&S.value>0),Ge=w(()=>({gridTemplateColumns:`repeat(${j}, minmax(0, 1fr))`})),Fe=w(()=>f.value.map(a=>{const e=W(a);return{id:a.id,top:e.row/X*100,left:e.col/J*100,color:we[a.key].color,hpPercent:Math.max(0,a.hp)/(a.maxHp||1)}})),ze=w(()=>g.value==="defeat"),z=(a,e)=>`${a},${e}`,Te=a=>{for(let e=0;e<re;e+=1)for(let o=0;o<j;o+=1)if(G[e][o]===a)return{row:e,col:o};return null},ae=Te("S"),V=Te("E");if(!ae||!V)throw new Error("Map definition missing start or end tile.");const se=(()=>{const a=[ae],e=new Map;for(e.set(z(ae.row,ae.col),null);a.length;){const t=a.shift();if(t.row===V.row&&t.col===V.col)break;for(const[r,d]of Pe){const h=t.row+r,m=t.col+d;if(h<0||m<0||h>=re||m>=j||!Re.has(G[h][m]))continue;const R=z(h,m);e.has(R)||(e.set(R,z(t.row,t.col)),a.push({row:h,col:m}))}}const o=[];let n=z(V.row,V.col);if(!e.has(n))throw new Error("Could not connect start and end on the map.");for(;n;){const[t,r]=n.split(",").map(Number);o.push({row:t,col:r}),n=e.get(n)??null}return o.reverse()})(),de=se.length-1,Ve=()=>G.map((a,e)=>a.split("").map((o,n)=>{let t="road";return o==="#"&&(t="buildable"),o==="S"&&(t="start"),o==="E"&&(t="end"),{id:z(e,n),row:e,col:n,terrain:t,tower:null}})),Ke=()=>{ce.value=Ve()},K=()=>{F.value!==null&&(window.clearTimeout(F.value),F.value=null)},Ee=(a=Rs)=>{!A.value||g.value!=="prep"||!u.value||(K(),F.value=window.setTimeout(()=>{F.value=null,na()},Math.max(0,a)))},qe=()=>{A.value||g.value!=="prep"||(A.value=!0,Ee(900))},te=(a,e)=>({row:a*T+ye,col:e*T+ye}),Se=a=>({x:a.col/J*1e3,y:a.row/X*1e3}),xe=a=>{const e=y[a.key],o=e.baseDamage*(1+a.upgrades.damage*.1),n=e.baseRange*(1+a.upgrades.range*.1),t=e.fireDelay/(1+a.upgrades.speed*.1),r=Math.max(U,t*B);return{damage:o,range:n,fireDelay:Number(t.toFixed(2)),fireDelayMs:r,blueprint:e}},Ce=(a,e)=>{const o=y[a.key];return Math.round(o.baseUpgradeCosts[e]*Math.pow(1.5,a.upgrades[e]))},pe=(a,e,o)=>{if(typeof window>"u")return;const n=Se(a),t=Se(e),r={id:Y(),x1:n.x,y1:n.y,x2:t.x,y2:t.y,type:o};$.value=[...$.value,r];const d=o==="sniper"?1e3:750,h=window.setTimeout(()=>{Z.delete(r.id),$.value=$.value.filter(m=>m.id!==r.id)},d);Z.set(r.id,h)},ve=()=>{typeof window<"u"&&Z.forEach(a=>window.clearTimeout(a)),Z.clear(),$.value=[]},Ye=(a,e)=>{if(typeof window>"u")return;const o={id:Y(),top:a.row/X*100,left:a.col/J*100,height:e*T*2/X*100,width:e*T*2/J*100};L.value=[...L.value,o];const n=window.setTimeout(()=>{ee.delete(o.id),L.value=L.value.filter(t=>t.id!==o.id)},600);ee.set(o.id,n)},he=()=>{typeof window<"u"&&ee.forEach(a=>window.clearTimeout(a)),ee.clear(),L.value=[]},W=a=>{const e=Math.min(de,Math.floor(a.progress)),o=Math.min(de,e+1),n=se[e],t=se[o],r=Math.max(0,a.progress-e),d=te(n.row,n.col),h=te(t.row,t.col);return{row:d.row+(h.row-d.row)*r,col:d.col+(h.col-d.col)*r}},me=a=>{x.value+=a.bounty,v.enemiesSlain+=1,v.goldEarned+=a.bounty},je=a=>{S.value=Math.max(0,S.value-a.damage),v.leaks+=1,S.value<=0&&oa()},Xe=()=>{const a=[];for(const e of f.value){if(e.progress+=e.speed*Be,e.progress>=de){je(e);continue}a.push(e)}f.value=a},Je=(a,e)=>{const o=te(a.row,a.col);return f.value.map(n=>({enemy:n,target:W(n)})).filter(({target:n})=>Math.hypot(o.row-n.row,o.col-n.col)/T<=e+.01).sort((n,t)=>t.enemy.progress-n.enemy.progress).map(({enemy:n})=>n)},Qe=a=>{const e=xe(a),o=te(a.row,a.col),n=He[a.key];if(a.cooldownMs>0){a.cooldownMs=Math.max(0,a.cooldownMs-U);return}const t=Je(a,e.range);if(!t.length)return;const r=t[0];if(a.cooldownMs=e.fireDelayMs,e.blueprint.behavior==="single"){const d=W(r);r.hp-=e.damage,n&&pe(o,d,n),r.hp<=0&&me(r)}else if(e.blueprint.behavior==="aoe"){const d=W(r);n&&pe(o,d,n),f.value.filter(m=>{const R=W(m);return Math.hypot(d.row-R.row,d.col-R.col)/T<=(e.blueprint.aoeRadius??1)}).forEach(m=>{m.hp-=e.damage,m.hp<=0&&me(m)}),Ye(d,e.blueprint.aoeRadius??1)}else t.slice(0,e.blueprint.chainTargets??1).forEach((h,m)=>{const R=W(h),De=e.damage*(1-m*.2);h.hp-=De,n&&pe(o,R,n),h.hp<=0&&me(h)});f.value=f.value.filter(d=>d.hp>0)},Ze=()=>{ce.value.forEach(a=>{a.forEach(e=>{e.tower&&Qe(e.tower)})})},ea=()=>{if(!u.value)return;const a=u.value,e=a.baseHealth*_e.value,o={id:Y(),key:a.key,hp:e,maxHp:e,speed:a.speed,damage:a.damage,bounty:a.bounty,progress:0};f.value=[...f.value,o]},aa=()=>{!u.value||!(D.value>=u.value.count&&f.value.length===0)||(q(),g.value="prep",D.value=0,M.value=B,H.value>=be-1?(v.phasesCleared=E.value,E.value+=1,H.value=0):H.value+=1,S.value>0&&A.value&&Ee())},sa=()=>{if(g.value==="running"){if(u.value&&D.value<u.value.count){const a=Math.max(U,u.value.spawnGap*B);M.value>0?M.value=Math.max(0,M.value-U):(ea(),D.value+=1,M.value=a)}Xe(),Ze(),aa()}},ta=()=>{q(),Q.value=window.setInterval(sa,U)},q=()=>{Q.value!==null&&(window.clearInterval(Q.value),Q.value=null)},oa=()=>{g.value!=="defeat"&&(g.value="defeat",q(),K(),A.value=!1,ve(),he())},ge=()=>{q(),K(),Ke(),I.value=ie[0],g.value="prep",E.value=1,H.value=0,S.value=le,ue.value=le,x.value=Ae,v.towersPlaced=0,v.enemiesSlain=0,v.leaks=0,v.goldEarned=0,v.phasesCleared=0,f.value=[],D.value=0,M.value=B,A.value=!1,b.value=null,ve(),he()},na=()=>{Ue.value&&(K(),g.value="running",D.value=0,M.value=B,ta())},la=a=>{if(a.terrain!=="buildable"){ne({title:"Invalid tile",description:"Only rune-marked pads (#) can host towers.",variant:"destructive"});return}if(a.tower){ne({title:"Occupied",description:"Remove or upgrade the tower already here.",variant:"destructive"});return}if(x.value<I.value.cost){ne({title:"Not enough gold",description:"Claim more bounty before building that.",variant:"destructive"});return}x.value-=I.value.cost,v.towersPlaced+=1,a.tower={id:Y(),key:I.value.key,row:a.row,col:a.col,cooldownMs:0,upgrades:{range:0,speed:0,damage:0}},b.value=a.tower},ra=a=>{I.value=a},ia=a=>{if(a.tower){b.value=a.tower;return}la(a)},ca=()=>{b.value=null},ua=(a,e)=>{const o=Ce(a,e);if(x.value<o){ne({title:"Need more gold",description:`Upgrade costs ${o} gold.`,variant:"destructive"});return}x.value-=o,a.upgrades[e]+=1},da=a=>{const e=xe(a);return`DMG ${e.damage.toFixed(0)} | Range ${e.range.toFixed(1)} | Delay ${e.fireDelay}`};return ha(()=>{ge()}),ma(()=>{q(),K(),ve(),he()}),(a,e)=>{var o,n;return c(),i("div",Ta,[s("header",Ea,[s("button",{type:"button",class:"back-button",onClick:e[0]||(e[0]=t=>_($e).push("/"))},[P(_(ba),{class:"icon"}),e[1]||(e[1]=N(" Back ",-1))]),s("div",Sa,[P(_(Me),{class:"icon"}),s("div",null,[e[2]||(e[2]=s("p",{class:"label"},"Phase",-1)),s("p",xa,l(E.value),1)]),s("div",null,[e[3]||(e[3]=s("p",{class:"label"},"Enemy Health",-1)),s("p",Ca,l(We.value)+"%",1)])])]),s("section",Da,[e[4]||(e[4]=s("div",null,[s("p",{class:"hero-pill"},"Dwarven Defense"),s("h1",null,"Hold the stoneway"),s("p",null," Place towers on rune-marked pads, then unleash each wave. Every phase holds the same five waves: normal, fast, tough, swarm, boss, and once a phase falls the enemy doubles their health again with no upper limit. ")],-1)),s("div",Ma,[g.value==="prep"&&!A.value?(c(),i("button",{key:0,type:"button",class:"cta-button",onClick:qe}," Begin Defense ")):g.value==="prep"?(c(),i("p",Aa,"Next wave arming")):g.value==="running"?(c(),i("p",Ra,"Wave in progress")):(c(),i("button",{key:3,type:"button",class:"cta-button",onClick:ge}," Rebuild the Gate "))])]),s("section",Pa,[s("div",Ba,[s("div",Ia,[P(_(wa),{class:"icon"}),e[5]||(e[5]=N(" Keep Integrity ",-1))]),s("p",Ha,l(S.value)+" / "+l(ue.value),1),s("div",$a,[s("span",{class:"progress-fill",style:O({width:`${Le.value}%`})},null,4)])]),s("div",La,[s("div",Wa,[P(_(ya),{class:"icon"}),e[6]||(e[6]=N(" Treasury ",-1))]),s("p",Na,l(x.value)+" gold",1),s("p",Oa,"Gold earned: "+l(v.goldEarned),1)]),s("div",Ua,[s("div",Ga,[P(_(Me),{class:"icon"}),N(" "+l(Ne.value),1)]),s("p",Fa,l(((o=u.value)==null?void 0:o.name)??"All Clear"),1),s("p",za,"Raiders remaining: "+l(Oe.value+f.value.length),1)]),s("div",Va,[s("div",Ka,[P(_(_a),{class:"icon"}),e[7]||(e[7]=N(" Campaign Stats ",-1))]),s("p",qa,l(v.towersPlaced)+" towers",1),s("p",Ya,"Kills "+l(v.enemiesSlain)+" / Leaks "+l(v.leaks),1)])]),s("div",ja,[s("section",Xa,[s("header",Ja,[e[8]||(e[8]=s("div",null,[s("p",{class:"label"},"Battle Map"),s("h2",null,"Stoneway Blueprint"),s("p",{class:"panel-subtext"},"Tap # pads to build. Roads (.) carry enemies from S to E.")],-1)),s("div",Qa,"Path tiles: "+l(_(se).length),1)]),s("div",Za,[s("div",{class:"board-grid",style:O(Ge.value)},[(c(!0),i(k,null,C(ce.value,t=>(c(),i(k,{key:t[0].id},[(c(!0),i(k,null,C(t,r=>(c(),i("button",{key:r.id,type:"button",class:fe(["board-cell",[`terrain-${r.terrain}`,{buildable:r.terrain==="buildable",occupied:!!r.tower}]]),onClick:d=>ia(r)},[r.terrain==="start"?(c(),i("span",as,"S")):r.terrain==="end"?(c(),i("span",ss,"E")):oe("",!0),r.tower?(c(),i("div",ts,[P(_(ka),{class:"chip-icon"}),s("span",null,l(y[r.tower.key].short),1)])):oe("",!0)],10,es))),128))],64))),128))],4),s("div",os,[(c(!0),i(k,null,C(Fe.value,t=>(c(),i("div",{key:t.id,class:"enemy-marker",style:O({top:`${t.top}%`,left:`${t.left}%`})},[s("div",ns,[s("span",{class:"enemy-health-fill",style:O({width:`${t.hpPercent*100}%`})},null,4)]),s("span",{class:"enemy-dot",style:O({backgroundColor:t.color})},null,4)],4))),128))]),s("div",ls,[(c(!0),i(k,null,C(L.value,t=>(c(),i("span",{key:t.id,class:"explosion-ring",style:O({top:`${t.top}%`,left:`${t.left}%`,width:`${t.width}%`,height:`${t.height}%`})},null,4))),128))]),(c(),i("svg",rs,[(c(!0),i(k,null,C($.value,t=>(c(),i("line",{key:t.id,class:fe(["trace-line",`trace-${t.type}`]),x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},null,10,is))),128))]))])]),s("aside",cs,[s("section",us,[e[9]||(e[9]=s("div",{class:"panel-header"},[s("h3",null,"Blueprints"),s("p",null,"Select a design, then click a pad.")],-1)),s("div",ds,[(c(),i(k,null,C(ie,t=>s("button",{key:t.key,type:"button",class:fe(["blueprint-card",{active:I.value.key===t.key,unaffordable:t.cost>x.value}]),onClick:r=>ra(t)},[s("div",vs,[s("h4",null,l(t.name),1),s("span",hs,l(t.cost)+"g",1)]),s("p",null,l(t.description),1),s("ul",null,[(c(!0),i(k,null,C(t.tags,r=>(c(),i("li",{key:r},l(r),1))),128))])],10,ps)),64))])]),s("section",ms,[s("div",gs,[e[10]||(e[10]=s("h3",null,"Wave Intel",-1)),s("p",null,l(((n=u.value)==null?void 0:n.description)??"Every foe defeated. Prepare for the next phase."),1)]),u.value?(c(),i("div",fs,[s("div",null,[e[11]||(e[11]=s("p",{class:"wave-label"},"Enemy Type",-1)),s("p",bs,l(u.value.name),1),s("p",ws,l(u.value.count)+" units / "+l(u.value.spawnGap)+" tick gap",1)]),s("div",null,[e[12]||(e[12]=s("p",{class:"wave-label"},"HP Scaling",-1)),s("p",ys,l(u.value.baseHealth)+" x "+l(E.value)+" = "+l(u.value.baseHealth*E.value),1),s("p",_s,"Damage "+l(u.value.damage)+" / Bounty "+l(u.value.bounty),1)])])):oe("",!0)]),b.value?(c(),i("section",ks,[s("div",Ts,[s("div",null,[s("h3",null,l(y[b.value.key].name),1),s("p",null,l(da(b.value)),1)]),s("button",{type:"button",class:"secondary-button",onClick:ca},"Close")]),s("div",Es,[(c(),i(k,null,C(["range","speed","damage"],t=>s("button",{key:`menu-${b.value.id}-${t}`,type:"button",class:"upgrade-button",onClick:r=>ua(b.value,t)},[N(" +10% "+l(t)+" (Lv "+l(b.value.upgrades[t])+" -> "+l(b.value.upgrades[t]+1)+") ",1),s("span",xs,l(Ce(b.value,t))+"g",1)],8,Ss)),64))])])):(c(),i("section",Cs,[...e[13]||(e[13]=[s("div",{class:"panel-header"},[s("h3",null,"Tower Upgrades")],-1),s("p",null,"Click a tower on the map to manage its stats.",-1)])]))])]),ze.value?(c(),i("div",Ds,[s("div",Ms,[e[14]||(e[14]=s("p",{class:"overlay-title"},"Gates Fallen",-1)),s("p",As," Phase "+l(E.value)+" collapsed after clearing "+l(v.phasesCleared)+" full phase"+l(v.phasesCleared===1?"":"s")+". ",1),s("button",{type:"button",class:"cta-button",onClick:ge}," Try Again ")])])):oe("",!0)])}}}),Gs=fa(Ps,[["__scopeId","data-v-047a4f7e"]]);export{Gs as default};
